---
title: '**KEY** Introduction to R: Homework 2'
output:
  html_document: default
---

### **Instructions**

1. Please submit your filled out .Rmd file to the assignment drop box on CoursePlus: https://courseplus.jhu.edu/core/index.cfm/go/db:assignment.submit/assignmentID/40988/coID/16733/ 

2. All assignments are due by the end of the grading period for this term (Wednesday, Jan 26, 2022 at 11:59pm EST). Please reach out to us if you need help before this time!

### **Getting Started**

In this assignment, we will be working with a dataset from the "Kaggle" website, which hosts competitions for prediction and machine learning. More details on this dataset are here: https://www.kaggle.com/c/DontGetKicked/overview/background.

```{r initiatePackages, message=FALSE}
## you can add more, or change...these are suggestions
library(tidyverse)
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
```

### **Problem Set**

1) Make a new variable:
  - Type out your birthday in day-month-year format (1-Jan) and assign it to a new variable "bday".
  - Make an kind of comment to yourself anywhere in this code chunk (such as a suggestion to add the year later).

```{r}
bday <- "5-Nov"
# We should probably add the year later
```

2) Combine "bday" with a character string that contains your name. Name this newly combined variable "me".

```{r}
name <- "Guy Fawkes"
me <- c(bday, name)

# OR

me <- c(bday, "Guy Fawkes")
```

3) Determine the data class for "me".

```{r}
class(me)
# The class is "character"
```

4) If I want to do `me / 2` I get the following error: "Error in me/2 : non-numeric argument to binary operator". Why? Include your answer in a comment inside the R chunk.

```{r}
# R cannot perform operations (math) on character data.
```

**Now let's move to the dataset.**

5) Get the dataset: https://jhudatascience.org/intro_to_R_class/data/kaggleCarAuction.csv. You can use the link, download it, or use whatever method you like for getting the file. Read the data set in using `read_csv()` and name the dataset "cars".

```{r}
cars <- read_csv("https://jhudatascience.org/intro_to_R_class/data/kaggleCarAuction.csv")

# OR

url <- "https://jhudatascience.org/intro_to_R_class/data/kaggleCarAuction.csv"
cars <- read_csv(url)

# OR

download.file("https://jhudatascience.org/intro_to_R_class/data/kaggleCarAuction.csv",
              destfile = "cars_data.csv",
              overwrite = TRUE, 
              mode = "wb")
cars <- read_csv("cars_data.csv")
```

6) Import the data "dictionary" from https://jhudatascience.org/intro_to_R_class/data/Carvana_Data_Dictionary_formatted.txt. Use the `read_tsv()` function and name this data "key". 

```{r}
key <- read_tsv("https://jhudatascience.org/intro_to_R_class/data/Carvana_Data_Dictionary_formatted.txt")

# OR

download.file("https://jhudatascience.org/intro_to_R_class/data/Carvana_Data_Dictionary_formatted.txt",
              destfile = "dict.txt",
              overwrite = TRUE, 
              mode = "wb")
key <- read_tsv("dict.txt")
```

7) Save the `cars` data in an .rds file so you can access the data later. Use the `write_rds()` function.

```{r q4}
write_rds(cars, file = "kaggle.rds")
```

8) The first three columns of the cars data are "RefId", "IsBadBuy", and "PurchDate". Retrieve the full column specification for this data so that you can see what class type these columns are (e.g., col_character(), col_double()). Write these first three specifications in a comment.

```{r}
spec(cars)
# RefId = col_double()
# IsBadBuy = col_double()
# PurchDate = col_character()
```

5) How many cars are in the dataset? How many variables are recorded for each car?

```{r q5}
dim(cars)
nrow(cars)
```

There are `r nrow(cars)` observations in the dataset.

6) What is the range of the manufacturer's years of the vehicles? Use "VehYear".

```{r q6}
range(cars$VehYear)
table(cars$VehYear)
```

7) How many cars were from before 2004, and what percent/proportion do these represent?<br /> 
**Hint:** use `summarize()` and `filter()` functions or `sum()`.

```{r, q7}
sum(cars$VehYear < 2004)
mean(cars$VehYear < 2004)
table(cars$VehYear < 2004)
```

8) Drop any vehicles that cost less than or equal to $1500 ("VehBCost") or that have missing values. How many vehicles were removed?<br />
**Hint:** `filter()` removes missing values.<br />
**Use this reduced dataset (generated in question 8) for all subsequent questions (9 through 12).**

```{r, q8}
sum(cars$VehBCost <= 1500 | is.na(cars$VehBCost))
cars = filter(cars, VehBCost > 1500)
nrow(cars)
```

There are `r nrow(cars)` after filtering by price.

9) How many different vehicle a) manufacturers/makes ("Make"), b) models ("Model"), and c) sizes ("Size") are there?<br />
**Hint:** use `table()` or `group_by()` with `tally()` or `summarize()`.

```{r, q9}
length(unique(cars$Make)) # a
length(table(cars$Make))
length(unique(cars$Model)) # b
length(unique(cars$Size)) # c
```

10) Which vehicle a) make, b) model, and c) color had the highest average acquisition cost paid for the vehicle at time of purchase, and what was this cost?<br />
**Hint:** use  `group_by()` with `summarize()`. Be sure to use the key to find the column that corresponds to the aquisition cost paid for the vehicle at time of purchase!

```{r, q10}
cars %>% group_by(Make) %>% 
  summarize(mean = mean(VehBCost)) %>% 
  arrange(desc(mean))
cars %>% group_by(Model) %>% 
  summarize(mean = mean(VehBCost)) %>% 
  arrange(desc(mean))

cars %>% group_by(Color) %>% 
  summarize(mean = mean(VehBCost)) %>% 
  arrange(desc(mean))
```

11) Which vehicle a) make, b) model, and c) color had the highest variability in acquisition cost paid for the vehicle at time of purchase?

```{r q11}
cars %>% group_by(Make) %>% 
  summarize(var = var(VehBCost)) %>% 
  arrange(desc(var))
cars %>% group_by(Model) %>% 
  summarize(var = var(VehBCost)) %>% 
  arrange(desc(var))

cars %>% group_by(Color) %>% 
  summarize(var = var(VehBCost)) %>% 
  arrange(desc(var))
```

12) How many vehicles (using `filter()` or `sum()` ):
    a. Were red and have fewer than 30,000 miles?
    b. Are made by GMC and were purchased in Texas? 
    c. Are blue or red?
    d. Are made by Chrysler or Nissan and are white or silver?
    e. Are automatic, blue, Pontiac cars with under 40,000 miles? 
 
```{r, q12}
sum(cars$Color == "RED" & cars$VehOdo < 30000)

# b.	Are made by GMC and were purchased in Texas? 
sum(cars$Make == "GMC" & cars$VNST == "TX")

# c.	Are blue or red?
sum(cars$Color == "BLUE" | cars$Color == "RED" )
sum(cars$Color %in% c("BLUE","RED"))

# d.	Are made by Chrysler or Nissan and are white or silver? 
sum((cars$Make == "CHRYSLER" | cars$Make=="NISSAN") & (cars$Color == "WHITE" | cars$Color == "SILVER" ))
sum(cars$Make %in% c("CHRYSLER","NISSAN") & 
	cars$Color %in% c("WHITE","SILVER" ))

# e.	Are automatic, blue, Pontiac cars with under 40,000 miles? 
sum(cars$Transmission == "AUTO" & cars$Color=="BLUE" & 
	cars$Make == "PONTIAC" & cars$VehOdo < 40000)

```
